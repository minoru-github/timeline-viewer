# Timeline Viewer

シンプルなブラウザベースのシーケンス／タイムライン可視化ツールです。

**概要**

- 各スレッド（ファイル名）ごとのモジュール配列を読み込み、依存関係を考慮したガント風タイムラインを描画します。
- 依存関係の作成・削除、ドラッグ＆ドロップでのスレッド再割当、自動リスケジューリング、Undo/Redo をサポートします。

**主な機能**

- JSON ファイル（スレッド毎）を読み込み、自動検証（時間 > 0、from/to の整合性、単一スレッド定義、サイクル検出など）を行います。
- SVG による矢印で依存関係を表示。矢印選択と削除（Deleteキー／Deleteボタン）に対応。
- Ctrl+クリックで A → B の依存関係を作成。Ctrl を押しながらのドラッグは無効化されます。
- 図の SVG エクスポート（スタイル・エラー含む）と、編集後のスレッド別 JSON をブラウザからダウンロード可能

**ファイル構成（主要ファイル）**

- `index.html` — UI とコントロール
- `styles.css` — 見た目の定義
- `app.js` — パーサ、スケジューラ、レンダラ、インタラクション、エクスポート機能の本体

**入力フォーマット（スレッド単位 JSON）**
ファイル名（拡張子を除く）がスレッド名になります。ファイルの中身はモジュール配列で、各要素は次のようなオブジェクトです：

```json
[
  {
    "module": "ServiceA",
    "time": 120,
    "from": [{"thread":"thread1","module":"X"}],
    "to": [{"thread":"thread2","module":"Y"}]
  }
]
```

`time` は実行時間（正の数）、`from`/`to` は依存関係（同一スレッドのモジュール名を指定）です。

**使い方（ローカルでの確認）**

1. このリポジトリのルートをローカルにクローンします。\
2. ブラウザで `index.html` を直接開くか、簡易サーバを立てて開きます（推奨）：

```bash
python -m http.server 8000
# または
npx http-server -p 8000
```

その後、ブラウザで `http://localhost:8000/` を開きます。

**エクスポートと出力ポリシー**

- 図や編集済みデータはブラウザのダウンロードとして出力されます。
- リポジトリには `.gitignore` に `output/` が登録されています。

**ローカルでの開発メモ**

- 主要な編集箇所は `app.js` です。レンダリング、ドラッグ＆ドロップ、Undo/Redo、検証ロジックはここに集約されています。

---

## シーケンスデザイナー（HTML）

使い方:

- `index.html` をブラウザで開いてください（ダブルクリックまたは静的サーバで配信）。
- ファイル選択で複数の `.json` ファイルを選択します（各ファイルは 1 つのモジュールを表します）。
- 選択後、自動的にパースしてレンダリングします。スレッドはレーン、モジュールはボックス、矢印はモジュール間のメッセージを表します。

入力フォーマット:

- ファイル名（拡張子 `.json` を除く）が `thread` 名になります。例: `0.json` → thread = "0"。
- 各ファイルは、そのスレッド内で実行される複数のモジュールを配列で記述します。
- 各モジュールは以下のオブジェクト形式です:

```
{
  "module": "a",    // モジュール名
  "time": 2,        // 実行時間（ミリ秒）
  "from": [
     {
      "thread":"0",
      "module":"x"
      },
      ... 
  ],
  "to": [
    {
      "thread":"1",
      "module":"y"
      }
      ,
    ...
  ]
}
```

- `from` / `to` 配列には、相手の `thread` と `module` の両方を指定してください（同一スレッドなら同じ `thread` 値を指定します）。`"none"` 相当は空配列にしてください。

例 — `sample/0.json` (thread = "0"):

```
[
  {
    "module":"a",
    "time":1,
    "from":[],
    "to":[
      {
        "thread":"1",
        "module":"c"
      }
      ,
      {
        "thread":"2",
        "module":"d"
      }
    ]
  },
  {
    "module":"e",
    "time":4,
    "from":[
      {
        "thread":"2",
        "module":"d"
      }
    ],
    "to":[]
  }
]
```

注意事項:

- JSON が不正な場合はポップアップでエラーが表示されます。
- 検証エラー（無効な時間値、from/to の不整合、同一スレッド上の順序不明、循環依存など）はポップアップとタイムライン下の「エラーパネル」に一覧表示されます。
- 検証エラーがあっても可能な限りタイムラインはレンダリングされます（警告扱い）。
- `Export SVG` は現在ページ上に表示されているエラーパネルの内容も埋め込むため、SVG にエラー一覧が含まれます。
- サンプルデータは `ok_sample_0/`, `ok_sample_1/`, `ng_sample_0/`, `ng_sample_1/`フォルダ内の JSON を参照してください（各ファイルは thread 単位でモジュール配列を含みます）。
